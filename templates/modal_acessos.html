<!-- MODAL CADASTRO ACESSO -->
<div id="modalAcesso" class="modal-overlay" style="display: none;">
    <div class="modal-acesso">
        <div class="modal-header-acesso">
            <h2 class="modal-title"><span class="terminal-prefix">&gt;</span> Novo Acesso</h2>
            <button class="btn-close-modal" onclick="fecharModalAcesso()"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body-acesso">
            <form method="POST" action="{% url 'cadastrar_acesso' %}">
                {% csrf_token %}
                <input type="hidden" name="cliente" value="{{ cliente.id }}">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Descrição</label>
                            <input type="text" name="tipo" placeholder="Descrição do host" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Função</label>
                            <div class="custom-search-select">
                                <input type="text" class="search-select-input" id="funcao_input" 
                                       placeholder="Digite para buscar..." autocomplete="off" 
                                       oninput="filterOptions('funcao')" required>
                                <input type="hidden" id="funcao" name="funcao">
                                <div class="search-select-dropdown" id="funcao-dropdown">
                                    {% for funcao in funcao_equipamentos %}
                                    <div class="search-select-option" data-value="{{ funcao.id }}" data-text="{{ funcao.descricao }}">
                                        {{ funcao.descricao }}
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Modelo</label>
                            <div class="custom-search-select">
                                <input type="text" class="search-select-input" id="modelo_input" 
                                       placeholder="Digite para buscar..." autocomplete="off" 
                                       oninput="filterOptions('modelo')" required>
                                <input type="hidden" id="modelo" name="modelo">
                                <div class="search-select-dropdown" id="modelo-dropdown">
                                    {% for modelo in modelos %}
                                    <div class="search-select-option" data-value="{{ modelo.id }}" data-text="{{ modelo.nome }}">
                                        {{ modelo.nome }}
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Hostname</label>
                            <input type="text" name="hostname" placeholder="Ex: sw-core-01" required>
                        </div>
                    </div>
                </div>
                <div class="form-group-modal">
                    <label><span class="label-prefix">//</span> Hostname IPv6</label>
                    <input type="text" name="hostname_ipv6" placeholder="Ex: 2001:db8::1">
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Protocolo</label>
                            <select name="protocolo" required>
                                <option value="">Selecione...</option>
                                <option value="SSH">SSH</option>
                                <option value="Telnet">Telnet</option>
                                <option value="HTTP">HTTP</option>
                                <option value="HTTPS">HTTPS</option>
                                <option value="RDP">RDP</option>
                                <option value="VNC">VNC</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Porta</label>
                            <input type="number" name="porta" placeholder="Ex: 22" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> winbox</label>
                            <input type="number" name="winbox" placeholder="Ex: 9291" >
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Usuário</label>
                            <input type="text" name="usuario" placeholder="Ex: admin" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Senha</label>
                            <input type="password" name="senha" placeholder="••••••••" required>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Senha Admin</label>
                            <input type="password" name="senha_adm" placeholder="••••••••">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Vlan gerencia</label>
                            <input type="text" name="vlan" placeholder="ex: 101">
                        </div>
                    </div>
                </div>
                <div class="terminal-status">
                    <span class="status-indicator"></span>
                    <span class="status-text">Sistema online</span>
                </div>
                <div class="modal-footer-acesso">
                    <button type="button" class="btn-cancel-modal" onclick="fecharModalAcesso()">
                        <i class="fas fa-times me-2"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-submit-modal">
                        <i class="fas fa-save me-2"></i> Cadastrar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- MODAL EDIÇÃO ACESSO -->
<div id="modalEditarAcesso" class="modal-overlay" style="display: none;">
    <div class="modal-acesso">
        <div class="modal-header-acesso">
            <h2 class="modal-title"><span class="terminal-prefix">&gt;</span> Editar Acesso</h2>
            <button class="btn-close-modal" onclick="fecharModalEditarAcesso()"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body-acesso">
            <form id="formEditarAcesso" method="POST">
                {% csrf_token %}
                <input type="hidden" name="acesso_id" id="edit_acesso_id">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Descrição</label>
                            <input type="text" name="tipo" id="edit_tipo" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Função</label>
                            <div class="custom-search-select">
                                <input type="text" class="search-select-input" id="edit_funcao_input" 
                                       placeholder="Digite para buscar..." autocomplete="off" 
                                       oninput="filterOptions('edit_funcao')" required>
                                <input type="hidden" id="edit_funcao" name="funcao">
                                <div class="search-select-dropdown" id="edit_funcao-dropdown">
                                    {% for funcao in funcao_equipamentos %}
                                    <div class="search-select-option" data-value="{{ funcao.id }}" data-text="{{ funcao.descricao }}">
                                        {{ funcao.descricao }}
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Modelo</label>
                            <div class="custom-search-select">
                                <input type="text" class="search-select-input" id="edit_modelo_input" 
                                       placeholder="Digite para buscar..." autocomplete="off" 
                                       oninput="filterOptions('edit_modelo')" required>
                                <input type="hidden" id="edit_modelo" name="modelo">
                                <div class="search-select-dropdown" id="edit_modelo-dropdown">
                                    {% for modelo in modelos %}
                                    <div class="search-select-option" data-value="{{ modelo.id }}" data-text="{{ modelo.nome }}">
                                        {{ modelo.nome }}
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Hostname</label>
                            <input type="text" name="hostname" id="edit_hostname" required>
                        </div>
                    </div>
                </div>
                <div class="form-group-modal">
                    <label><span class="label-prefix">//</span> Hostname IPv6</label>
                    <input type="text" name="hostname_ipv6" id="edit_hostname_ipv6">
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Protocolo</label>
                            <select name="protocolo" id="edit_protocolo" required>
                                <option value="">Selecione...</option>
                                <option value="SSH">SSH</option>
                                <option value="Telnet">Telnet</option>
                                <option value="HTTP">HTTP</option>
                                <option value="HTTPS">HTTPS</option>
                                <option value="RDP">RDP</option>
                                <option value="VNC">VNC</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Porta</label>
                            <input type="number" name="porta" id="edit_porta" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> winbox</label>
                            <input type="number" name="winbox" id="winbox" placeholder="Ex: 9291">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Usuário</label>
                            <input type="text" name="usuario" id="edit_usuario" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Senha</label>
                            <input type="password" name="senha" id="edit_senha" required>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Senha Admin</label>
                            <input type="password" name="senha_adm" id="edit_senha_adm">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Vlan gerencia</label>
                            <input type="text" name="vlan" id="edit_vlan">
                        </div>
                    </div>
                </div>
                <div class="terminal-status">
                    <span class="status-indicator"></span>
                    <span class="status-text">Sistema online</span>
                </div>
                <div class="modal-footer-acesso">
                    <button type="button" class="btn-cancel-modal" onclick="fecharModalEditarAcesso()">
                        <i class="fas fa-times me-2"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-submit-modal">
                        <i class="fas fa-save me-2"></i> Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- MODAL DUPLICAR ACESSO -->
<div id="modalDuplicarAcesso" class="modal-overlay" style="display: none;">
    <div class="modal-acesso">
        <div class="modal-header-acesso">
            <h2 class="modal-title"><span class="terminal-prefix">&gt;</span> Duplicar Acesso</h2>
            <button class="btn-close-modal" onclick="fecharModalDuplicarAcesso()"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body-acesso">
           <form method="POST" action="{% url 'cadastrar_acesso' %}">
                {% csrf_token %}
                <input type="hidden" name="cliente" value="{{ cliente.id }}">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Descrição</label>
                            <input type="text" name="tipo" id="dup_tipo" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Função</label>
                            <div class="custom-search-select">
                                <input type="text" class="search-select-input" id="dup_funcao_input" 
                                       placeholder="Digite para buscar..." autocomplete="off" 
                                       oninput="filterOptions('dup_funcao')" required>
                                <input type="hidden" id="dup_funcao" name="funcao">
                                <div class="search-select-dropdown" id="dup_funcao-dropdown">
                                    {% for funcao in funcao_equipamentos %}
                                    <div class="search-select-option" data-value="{{ funcao.id }}" data-text="{{ funcao.descricao }}">
                                        {{ funcao.descricao }}
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Modelo</label>
                            <div class="custom-search-select">
                                <input type="text" class="search-select-input" id="dup_modelo_input" 
                                       placeholder="Digite para buscar..." autocomplete="off" 
                                       oninput="filterOptions('dup_modelo')" required>
                                <input type="hidden" id="dup_modelo" name="modelo">
                                <div class="search-select-dropdown" id="dup_modelo-dropdown">
                                    {% for modelo in modelos %}
                                    <div class="search-select-option" data-value="{{ modelo.id }}" data-text="{{ modelo.nome }}">
                                        {{ modelo.nome }}
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Hostname</label>
                            <input type="text" name="hostname" id="dup_hostname" required>
                        </div>
                    </div>
                </div>
                <div class="form-group-modal">
                    <label><span class="label-prefix">//</span> Hostname IPv6</label>
                    <input type="text" name="hostname_ipv6" id="dup_hostname_ipv6">
                </div>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Protocolo</label>
                            <select name="protocolo" id="dup_protocolo" required>
                                <option value="">Selecione...</option>
                                <option value="SSH">SSH</option>
                                <option value="Telnet">Telnet</option>
                                <option value="HTTP">HTTP</option>
                                <option value="HTTPS">HTTPS</option>
                                <option value="RDP">RDP</option>
                                <option value="VNC">VNC</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Porta</label>
                            <input type="number" name="porta" id="dup_porta" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> winbox</label>
                            <input type="number" name="winbox" id="dup_winbox" placeholder="Ex: 9291">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Usuário</label>
                            <input type="text" name="usuario" id="dup_usuario" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Senha</label>
                            <input type="password" name="senha" id="dup_senha" required>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Senha Admin</label>
                            <input type="password" name="senha_adm" id="dup_senha_adm">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Vlan gerencia</label>
                            <input type="text" name="vlan" id="dup_vlan">
                        </div>
                    </div>
                </div>
                <div class="terminal-status">
                    <span class="status-indicator"></span>
                    <span class="status-text">Sistema online</span>
                </div>
                <div class="modal-footer-acesso">
                    <button type="button" class="btn-cancel-modal" onclick="fecharModalDuplicarAcesso()">
                        <i class="fas fa-times me-2"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-submit-modal">
                        <i class="fas fa-save me-2"></i> Cadastrar Cópia
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>



<!-- MODAL UPLOAD DE DOCUMENTO -->
<div id="modalUploadDocumento" class="modal-overlay" style="display: none;">
    <div class="modal-acesso" style="max-width: 600px;">
        <div class="modal-header-acesso">
            <h2 class="modal-title"><span class="terminal-prefix">&gt;</span> Upload de Documento</h2>
            <button class="btn-close-modal" onclick="fecharModalUpload()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body-acesso">
            <form method="POST" action="{% url 'upload_documento' %}" enctype="multipart/form-data" id="formUploadDocumento">
                {% csrf_token %}
                <input type="hidden" name="cliente" value="{{ cliente.id }}">
                
                <!-- Área de Upload -->
                <div class="upload-area" id="uploadArea">
                    <input type="file" name="arquivo" id="fileInput" accept="*/*" required style="display: none;">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">
                        <p class="upload-title">Clique ou arraste o arquivo aqui</p>
                        <p class="upload-subtitle">Todos os formatos são aceitos</p>
                    </div>
                </div>

                <!-- Preview do Arquivo -->
                <div class="file-preview" id="filePreview" style="display: none;">
                    <div class="file-info">
                        <i class="fas fa-file file-icon"></i>
                        <div class="file-details">
                            <span class="file-name" id="fileName"></span>
                            <span class="file-size" id="fileSize"></span>
                        </div>
                        <button type="button" class="btn-remove-file" onclick="removerArquivo()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="upload-progress" id="uploadProgress" style="display: none;">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                </div>

                <div class="terminal-status">
                    <span class="status-indicator"></span>
                    <span class="status-text">Sistema online - Pronto para upload</span>
                </div>

                <div class="modal-footer-acesso">
                    <button type="button" class="btn-cancel-modal" onclick="fecharModalUpload()">
                        <i class="fas fa-times me-2"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-submit-modal" id="btnSubmitUpload">
                        <i class="fas fa-upload me-2"></i> Enviar Arquivo
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- MODAL UPLOAD VPN -->
<div id="modalUploadVPN" class="modal-overlay" style="display: none;">
    <div class="modal-acesso" style="max-width: 700px;">
        <div class="modal-header-acesso">
            <h2 class="modal-title"><span class="terminal-prefix">&gt;</span> Adicionar Configuração VPN</h2>
            <button class="btn-close-modal" onclick="fecharModalUploadVPN()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body-acesso">
            <form method="POST" action="{% url 'upload_vpn' %}" enctype="multipart/form-data" id="formUploadVPN">
                {% csrf_token %}
                <input type="hidden" name="cliente" value="{{ cliente.id }}">
                
                <!-- Área de Upload -->
                <div class="upload-area" id="uploadAreaVPN">
                    <input type="file" name="arquivo" id="fileInputVPN" accept=".ovpn,.conf,.key,.crt,.pem" required style="display: none;">
                    <div class="upload-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="upload-text">
                        <p class="upload-title">Clique ou arraste o arquivo VPN aqui</p>
                        <p class="upload-subtitle">Formatos: .ovpn, .conf, .key, .crt, .pem</p>
                    </div>
                </div>

                <!-- Preview do Arquivo -->
                <div class="file-preview" id="filePreviewVPN" style="display: none;">
                    <div class="file-info">
                        <i class="fas fa-file-alt file-icon"></i>
                        <div class="file-details">
                            <span class="file-name" id="fileNameVPN"></span>
                            <span class="file-size" id="fileSizeVPN"></span>
                        </div>
                        <button type="button" class="btn-remove-file" onclick="removerArquivoVPN()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>

                <!-- Campos de Credenciais -->
                <div class="credentials-section mt-4">
                    <h6 style="color: var(--accent-cyan); font-family: 'Courier New', monospace; text-transform: uppercase; font-size: 12px; margin-bottom: 20px; letter-spacing: 1px;">
                        <i class="fas fa-key me-2"></i> Credenciais (Opcional)
                    </h6>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group-modal">
                                <label><span class="label-prefix">//</span> Usuário</label>
                                <input type="text" name="usuario" placeholder="Ex: vpnuser">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group-modal">
                                <label><span class="label-prefix">//</span> Senha</label>
                                <input type="password" name="senha" placeholder="••••••••">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group-modal">
                        <label><span class="label-prefix">//</span> Private Key</label>
                        <textarea name="private_key" 
                                  rows="6" 
                                  placeholder="Cole aqui a chave privada (se necessário)"
                                  style="width: 100%; background: rgba(22, 27, 34, 0.9); border: 1px solid var(--border); color: var(--primary-green); font-family: 'Courier New', monospace; padding: 12px; font-size: 12px; border-radius: 4px; resize: vertical;"></textarea>
                    </div>
                </div>

                <div class="terminal-status">
                    <span class="status-indicator"></span>
                    <span class="status-text">Sistema online - Pronto para configuração VPN</span>
                </div>

                <div class="modal-footer-acesso">
                    <button type="button" class="btn-cancel-modal" onclick="fecharModalUploadVPN()">
                        <i class="fas fa-times me-2"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-submit-modal">
                        <i class="fas fa-save me-2"></i> Salvar Configuração
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- MODAL EDITAR VPN -->
<div id="modalEditarVPN" class="modal-overlay" style="display: none;">
    <div class="modal-acesso" style="max-width: 700px;">
        <div class="modal-header-acesso">
            <h2 class="modal-title"><span class="terminal-prefix">&gt;</span> Editar Configuração VPN</h2>
            <button class="btn-close-modal" onclick="fecharModalEditarVPN()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body-acesso">
            <form id="formEditarVPN" method="POST">
                {% csrf_token %}
                <input type="hidden" name="vpn_id" id="edit_vpn_id">
                
                <div class="form-group-modal">
                    <label><span class="label-prefix">//</span> Nome do Arquivo</label>
                    <input type="text" name="nome" id="edit_nome_vpn" disabled style="opacity: 0.6;">
                    <small style="color: var(--text-muted); font-size: 11px; display: block; margin-top: 5px;">
                        Para alterar o arquivo, exclua e crie uma nova configuração
                    </small>
                </div>

                <div class="credentials-section mt-4">
                    <h6 style="color: var(--accent-cyan); font-family: 'Courier New', monospace; text-transform: uppercase; font-size: 12px; margin-bottom: 20px; letter-spacing: 1px;">
                        <i class="fas fa-key me-2"></i> Credenciais
                    </h6>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group-modal">
                                <label><span class="label-prefix">//</span> Usuário</label>
                                <input type="text" name="usuario" id="edit_usuario_vpn" placeholder="Ex: vpnuser">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group-modal">
                                <label><span class="label-prefix">//</span> Senha</label>
                                <input type="password" name="senha" id="edit_senha_vpn" placeholder="••••••••">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group-modal">
                        <label><span class="label-prefix">//</span> Private Key</label>
                        <textarea name="private_key" 
                                  id="edit_private_key_vpn"
                                  rows="6" 
                                  placeholder="Cole aqui a chave privada"
                                  style="width: 100%; background: rgba(22, 27, 34, 0.9); border: 1px solid var(--border); color: var(--primary-green); font-family: 'Courier New', monospace; padding: 12px; font-size: 12px; border-radius: 4px; resize: vertical;"></textarea>
                    </div>
                </div>

                <div class="terminal-status">
                    <span class="status-indicator"></span>
                    <span class="status-text">Sistema online</span>
                </div>

                <div class="modal-footer-acesso">
                    <button type="button" class="btn-cancel-modal" onclick="fecharModalEditarVPN()">
                        <i class="fas fa-times me-2"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-submit-modal">
                        <i class="fas fa-save me-2"></i> Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- MODAL UPLOAD TOPOLOGIA -->
<div id="modalUploadTopologia" class="modal-overlay" style="display: none;">
    <div class="modal-acesso" style="max-width: 600px;">
        <div class="modal-header-acesso">
            <h2 class="modal-title"><span class="terminal-prefix">&gt;</span> Upload Imagem Topologia</h2>
            <button class="btn-close-modal" onclick="fecharModalUploadTopologia()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body-acesso">
            <form method="POST" action="{% url 'upload_topologia' %}" enctype="multipart/form-data" id="formUploadTopologia">
                {% csrf_token %}
                <input type="hidden" name="cliente" value="{{ cliente.id }}">
                
                <!-- Área de Upload -->
                <div class="upload-area" id="uploadAreaTopologia">
                    <input type="file" name="imagem" id="fileInputTopologia" accept="image/*" required style="display: none;">
                    <div class="upload-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="upload-text">
                        <p class="upload-title">Clique ou arraste a imagem aqui</p>
                        <p class="upload-subtitle">Formatos: JPG, PNG, GIF, SVG, WEBP</p>
                    </div>
                </div>

                <!-- Preview da Imagem -->
                <div class="image-preview-container" id="imagePreviewTopologia" style="display: none;">
                    <div class="image-preview-wrapper">
                        <img id="previewImageTopologia" src="" alt="Preview" class="preview-image">
                        <button type="button" class="btn-remove-file btn-remove-image" onclick="removerArquivoTopologia()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="file-details mt-3">
                        <span class="file-name" id="fileNameTopologia"></span>
                        <span class="file-size" id="fileSizeTopologia"></span>
                    </div>
                </div>

                <div class="terminal-status">
                    <span class="status-indicator"></span>
                    <span class="status-text">Sistema online - Pronto para upload de imagem</span>
                </div>

                <div class="modal-footer-acesso">
                    <button type="button" class="btn-cancel-modal" onclick="fecharModalUploadTopologia()">
                        <i class="fas fa-times me-2"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-submit-modal">
                        <i class="fas fa-upload me-2"></i> Enviar Imagem
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>





<!-- ========================================
     MODAL CADASTRAR CHAMADO
     ======================================== -->

<div id="modalCadastrarChamado" class="modal-overlay" style="display: none;">
    <div class="modal-acesso" style="max-width: 800px;">
        <div class="modal-header-acesso">
            <h2 class="modal-title"><span class="terminal-prefix">&gt;</span> Novo Chamado</h2>
            <button class="btn-close-modal" onclick="fecharModalCadastrarChamado()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="formCadastrarChamado" method="POST" action="{% url 'cadastrar_chamado' %}">
            {% csrf_token %}
            <input type="hidden" name="cliente" id="chamado_cliente_id" value="{{ cliente.id }}">
            
            <div class="modal-body-acesso">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Título do Chamado *</label>
                            <input type="text" name="titulo" class="form-control" placeholder="Digite o título do chamado" required>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Categoria</label>
                            <div class="custom-search-select">
                                <input type="hidden" name="categoria" id="categoria">
                                <input type="text" 
                                       id="categoria_input" 
                                       class="search-select-input" 
                                       placeholder="Digite para buscar categoria..."
                                       onkeyup="buscarCategorias(this.value)"
                                       autocomplete="off">
                                <button type="button" class="btn-add-categoria" onclick="abrirModalAdicionarCategoria()" title="Adicionar Nova Categoria">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <div id="categoria-dropdown" class="search-select-dropdown"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Prioridade *</label>
                            <select name="prioridade" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="BAIXA">Baixa</option>
                                <option value="NORMAL" selected>Normal</option>
                                <option value="ALTA">Alta</option>
                                <option value="URGENTE">Urgente</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Departamento *</label>
                            <select name="departamento" class="form-control" required>
                                <option value="">Selecione...</option>
                                <option value="SUPORTE_REDES">Suporte de Redes</option>
                                <option value="SERVIDORES">Servidores</option>
                                <option value="MONITORAMENTO">Monitoramento</option>
                            </select>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Responsável</label>
                            <div class="custom-search-select">
                                <input type="hidden" name="responsavel" id="responsavel">
                                <input type="text" 
                                       id="responsavel_input" 
                                       class="search-select-input" 
                                       placeholder="Digite para buscar usuário..."
                                       onkeyup="buscarUsuarios(this.value)"
                                       autocomplete="off">
                                <div id="responsavel-dropdown" class="search-select-dropdown"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Descrição *</label>
                            <textarea name="descricao" class="form-control" rows="4" placeholder="Descreva o problema ou solicitação..." required></textarea>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Comentário Inicial (Opcional)</label>
                            <textarea name="comentario" class="form-control" rows="3" placeholder="Adicione observações ou informações adicionais..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="terminal-status">
                    <span class="status-indicator"></span>
                    <span class="status-text">Sistema pronto para registrar chamado</span>
                </div>

                <div class="modal-footer-acesso">
                    <button type="button" class="btn-cancel-modal" onclick="fecharModalCadastrarChamado()">
                        <i class="fas fa-times me-2"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-submit-modal">
                        <i class="fas fa-check me-2"></i> Cadastrar Chamado
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- ========================================
     MODAL ADICIONAR CATEGORIA
     ======================================== -->

<div id="modalAdicionarCategoria" class="modal-overlay" style="display: none;">
    <div class="modal-acesso" style="max-width: 500px;">
        <div class="modal-header-acesso">
            <h2 class="modal-title"><span class="terminal-prefix">&gt;</span> Nova Categoria</h2>
            <button class="btn-close-modal" onclick="fecharModalAdicionarCategoria()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body-acesso">
            <div class="form-group-modal">
                <label><span class="label-prefix">//</span> Nome da Categoria *</label>
                <input type="text" id="nova_categoria_nome" class="form-control" placeholder="Ex: Hardware, Software, Rede...">
            </div>

            <div class="form-group-modal">
                <label><span class="label-prefix">//</span> Descrição (Opcional)</label>
                <textarea id="nova_categoria_descricao" class="form-control" rows="3" placeholder="Descrição da categoria..."></textarea>
            </div>

            <div class="terminal-status">
                <span class="status-indicator"></span>
                <span class="status-text">Pronto para adicionar categoria</span>
            </div>

            <div class="modal-footer-acesso">
                <button type="button" class="btn-cancel-modal" onclick="fecharModalAdicionarCategoria()">
                    <i class="fas fa-times me-2"></i> Cancelar
                </button>
                <button type="button" class="btn-submit-modal" onclick="salvarNovaCategoria()">
                    <i class="fas fa-check me-2"></i> Salvar Categoria
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ========================================
     MODAL VISUALIZAR/EDITAR CHAMADO
     ======================================== -->

<div id="modalVisualizarChamado" class="modal-overlay" style="display: none;">
    <div class="modal-acesso" style="max-width: 900px;">
        <div class="modal-header-acesso">
            <h2 class="modal-title"><span class="terminal-prefix">&gt;</span> Chamado #<span id="view_chamado_numero"></span></h2>
            <button class="btn-close-modal" onclick="fecharModalVisualizarChamado()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="formEditarChamado" method="POST">
            {% csrf_token %}
            <input type="hidden" id="view_chamado_id">
            
            <div class="modal-body-acesso">
                <!-- Abas de Detalhes e Comentários -->
                <ul class="nav nav-tabs mb-4" style="border-bottom: 2px solid var(--border);">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="trocarAbaModal(event, 'detalhes')">Detalhes</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="trocarAbaModal(event, 'comentarios')">
                            Comentários <span id="badge_comentarios" class="badge bg-primary ms-1">0</span>
                        </a>
                    </li>
                </ul>

                <!-- Aba Detalhes -->
                <div id="aba-detalhes" style="display: block;">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group-modal">
                                <label><span class="label-prefix">//</span> Título</label>
                                <input type="text" name="titulo" id="view_titulo" class="form-control">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group-modal">
                                <label><span class="label-prefix">//</span> Status</label>
                                <select name="status" id="view_status" class="form-control">
                                    <option value="ABERTO">Aberto</option>
                                    <option value="EM_ANDAMENTO">Em Andamento</option>
                                    <option value="AGUARDANDO">Aguardando</option>
                                    <option value="RESOLVIDO">Resolvido</option>
                                    <option value="FECHADO">Fechado</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="form-group-modal">
                                <label><span class="label-prefix">//</span> Prioridade</label>
                                <select name="prioridade" id="view_prioridade" class="form-control">
                                    <option value="BAIXA">Baixa</option>
                                    <option value="NORMAL">Normal</option>
                                    <option value="ALTA">Alta</option>
                                    <option value="URGENTE">Urgente</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="form-group-modal">
                                <label><span class="label-prefix">//</span> Departamento</label>
                                <select name="departamento" id="view_departamento" class="form-control">
                                    <option value="SUPORTE_REDES">Suporte de Redes</option>
                                    <option value="SERVIDORES">Servidores</option>
                                    <option value="MONITORAMENTO">Monitoramento</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group-modal">
                                <label><span class="label-prefix">//</span> Categoria</label>
                                <div class="custom-search-select">
                                    <input type="hidden" name="categoria" id="view_categoria">
                                    <input type="text" 
                                           id="view_categoria_input" 
                                           class="search-select-input" 
                                           placeholder="Digite para buscar categoria..."
                                           onkeyup="buscarCategorias(this.value, 'view')"
                                           autocomplete="off">
                                    <div id="view_categoria-dropdown" class="search-select-dropdown"></div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group-modal">
                                <label><span class="label-prefix">//</span> Responsável</label>
                                <div class="custom-search-select">
                                    <input type="hidden" name="responsavel" id="view_responsavel">
                                    <input type="text" 
                                           id="view_responsavel_input" 
                                           class="search-select-input" 
                                           placeholder="Digite para buscar usuário..."
                                           onkeyup="buscarUsuarios(this.value, 'view')"
                                           autocomplete="off">
                                    <div id="view_responsavel-dropdown" class="search-select-dropdown"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group-modal">
                                <label><span class="label-prefix">//</span> Descrição</label>
                                <textarea name="descricao" id="view_descricao" class="form-control" rows="5"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-row">
                                <span class="info-label">Cliente</span>
                                <span class="info-value" id="view_cliente"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-row">
                                <span class="info-label">Data Criação</span>
                                <span class="info-value" id="view_data_criacao"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Aba Comentários -->
                <div id="aba-comentarios" style="display: none;">
                    <div id="lista-comentarios" class="comentarios-container">
                        <!-- Comentários serão carregados aqui -->
                    </div>

                    <div class="adicionar-comentario-container">
                        <div class="form-group-modal">
                            <label><span class="label-prefix">//</span> Adicionar Comentário</label>
                            <textarea name="comentario_novo" id="novo_comentario" class="form-control" rows="3" placeholder="Digite seu comentário..."></textarea>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="comentario_interno" name="is_internal">
                                <label class="form-check-label" for="comentario_interno" style="color: var(--text-muted); font-size: 12px;">
                                    Comentário interno (não visível para o cliente)
                                </label>
                            </div>
                            <button type="button" class="btn-submit-modal" onclick="adicionarComentario()">
                                <i class="fas fa-paper-plane me-2"></i> Enviar
                            </button>
                        </div>
                    </div>
                </div>

                <div class="modal-footer-acesso">
                    <button type="button" class="btn-cancel-modal" onclick="fecharModalVisualizarChamado()">
                        <i class="fas fa-times me-2"></i> Fechar
                    </button>
                    <button type="button" class="btn-submit-modal" onclick="salvarEdicaoChamado()">
                        <i class="fas fa-save me-2"></i> Salvar Alterações
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
